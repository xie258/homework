<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Hello, AR Cube!</title>
    <!-- include three.js library -->
    <script src='js/three.js'></script>
    <!-- include jsartookit -->
    <script src="jsartoolkit5/artoolkit.min.js"></script>
    <script src="jsartoolkit5/artoolkit.api.js"></script>
    <!-- include threex.artoolkit -->
    <script src="threex/threex-artoolkitsource.js"></script>
    <script src="threex/threex-artoolkitcontext.js"></script>
    <script src="threex/threex-arbasecontrols.js"></script>
    <script src="threex/threex-armarkercontrols.js"></script>
</head>

<body>
    <canvas id="canvas"></canvas>
    <button onclick="draw()">draw</button>
    <button onclick="rotate()">rotate</button>
    <button onclick="StopAnimate()">stop rotate</button>

    <script>
        var scene, camera, renderer, clock, deltaTime, totalTime;

        var arToolkitSource, arToolkitContext;

        var markerRoot1, markerRoot2;

        var mesh1;

        var cube;

        var flag = 0; // 动画对象

        initialize();

        function initialize() {
            scene = new THREE.Scene();

            // let ambientLight = new THREE.AmbientLight(0xcccccc, 0.5);
            // scene.add(ambientLight);

            var light = new THREE.PointLight(0xffffff, 1, 100); //创建光源
            light.position.set(12, 15, 10); //设置光源的位置
            scene.add(light); //在场景中添加光源


            camera = new THREE.Camera();
            scene.add(camera);
            console.log(camera)

            renderer = new THREE.WebGLRenderer({
                antialias: true,  //反锯齿
                alpha: true,   //背景透明
                canvas: document.getElementById('canvas')
            })

            renderer.setClearColor(new THREE.Color(0x000000), 0)
            //开启设备摄像头
            arToolkitSource = new THREEx.ArToolkitSource({
                sourceType: 'webcam',
            });

            function onResize() {
                arToolkitSource.onResize()
                arToolkitSource.copySizeTo(renderer.domElement)
                if (arToolkitContext.arController !== null) {
                    arToolkitSource.copySizeTo(arToolkitContext.arController.canvas)
                }
            }

            arToolkitSource.init(function onReady() {
                onResize()
            });

            arToolkitContext = new THREEx.ArToolkitContext({
                cameraParametersUrl: 'https://xie258.github.io/homework/data/camera_para.dat',
                detectionMode: 'mono'
            });

        }

        function render() {
            renderer.render(scene, camera);
        }

        function update() {
            // update artoolkit on every frame
            if (arToolkitSource.ready !== false)
                arToolkitContext.update(arToolkitSource.domElement);
        }

        function animate() {
            if (flag == 1) {
                cube.rotation.x += 0.01; //x轴每秒旋转60次
                cube.rotation.y += 0.01;//y轴每秒旋转60次*/
            }
            requestAnimationFrame(animate);
            update();
            render();
        }

        let canvas = document.getElementById("canvas");
        let ctx = canvas.getContext("webgl");

        console.log(canvas)
        console.log(ctx);

        var geometry = new THREE.Geometry();
        var material = new THREE.LineBasicMaterial({ vertexColors: true });
        var color1 = new THREE.Color(0x444444), color2 = new THREE.Color(0xFF0000);

        //画线
        // canvas.onmousedown = function (e) {
        //     var geometry = new THREE.Geometry();
        //     var material = new THREE.LineBasicMaterial({ vertexColors: true });
        //     var color1 = new THREE.Color(0x444444), color2 = new THREE.Color(0xFF0000);

        //     let pX = (e.clientX / canvas.clientWidth) * 2 - 1;
        //     let pY = - (e.clientY / canvas.clientHeight) * 2 + 1;
        //     // 线的材质可以由2点的颜色决定
        //     var p1 = new THREE.Vector3(0, 0, 0);
        //     var p2 = new THREE.Vector3(pX, pY, 0);
        //     geometry.vertices.push(p1);
        //     geometry.vertices.push(p2);
        //     geometry.colors.push(color1, color2);
        //     var line = new THREE.Line(geometry, material, new THREE.LineSegments(geometry, material));
        //     scene.add(line);

        //     var circle = new THREE.CircleGeometry(1, 1, 0, 2 * Math.PI);
        //     scene.add(circle)
        // }

        //画长方体
        function draw() {
            if (!cube) {
                var geometry = new THREE.BoxGeometry(1, 1, 1);
                var material = new THREE.MeshBasicMaterial({ color: "yellow" });
                cube = new THREE.Mesh(geometry, material);
                scene.add(cube);
                render();
            }

        }

        function rotate() {
            flag = 1;
            animate();
        }

        function StopAnimate() {
            flag = 0;
        }

    </script>
</body>

</html>