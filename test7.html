<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <title>Hello, AR Cube!</title>
    <!-- include three.js library -->
    <script src='js/three.js'></script>
    <!-- include jsartookit -->
    <script src="jsartoolkit5/artoolkit.min.js"></script>
    <script src="jsartoolkit5/artoolkit.api.js"></script>
    <!-- include threex.artoolkit -->
    <script src="threex/threex-artoolkitsource.js"></script>
    <script src="threex/threex-artoolkitcontext.js"></script>
    <script src="threex/threex-arbasecontrols.js"></script>
    <script src="threex/threex-armarkercontrols.js"></script>
</head>

<body>
    <canvas id="canvas"></canvas>

    <script>
        var scene, camera, renderer, clock, deltaTime, totalTime;

        var arToolkitSource, arToolkitContext;

        var markerRoot1, markerRoot2;

        var mesh1;

        initialize();
        animate();

        function initialize() {
            scene = new THREE.Scene();

            let ambientLight = new THREE.AmbientLight(0xcccccc, 0.5);
            scene.add(ambientLight);

            camera = new THREE.Camera();
            scene.add(camera);

            renderer = new THREE.WebGLRenderer({
                antialias: true,  //反锯齿
				alpha: true,   //背景透明
                canvas: document.getElementById('canvas')
            })

            renderer.setClearColor(new THREE.Color(0x000000), 0)
            //开启设备摄像头
            arToolkitSource = new THREEx.ArToolkitSource({
				sourceType: 'webcam',
            });
            
            function onResize() {
				arToolkitSource.onResize()
				arToolkitSource.copySizeTo(renderer.domElement)
				if (arToolkitContext.arController !== null) {
					arToolkitSource.copySizeTo(arToolkitContext.arController.canvas)
				}
			}

			arToolkitSource.init(function onReady() {
				onResize()
			});

            arToolkitContext = new THREEx.ArToolkitContext({
				cameraParametersUrl: 'https://xie258.github.io/homework/data/camera_para.dat',
				detectionMode: 'mono'
			});
           
        }

        function render() {
            renderer.render(scene, camera);
        }

        function update() {
            // update artoolkit on every frame
            if (arToolkitSource.ready !== false)
                arToolkitContext.update(arToolkitSource.domElement);
        }

        function animate() {
            requestAnimationFrame(animate);
            update();
            render();
        }

        let canvas = document.getElementById("canvas");
        let ctx = canvas.getContext("webgl");

        console.log( canvas)
        console.log(ctx);     

        var geometry = new THREE.Geometry();
                var material = new THREE.LineBasicMaterial( { vertexColors: true } );
                var color1 = new THREE.Color( 0x444444 ), color2 = new THREE.Color( 0xFF0000 );

                // 线的材质可以由2点的颜色决定
                var p1 = new THREE.Vector3( -100, 0, 100 );
                var p2 = new THREE.Vector3(  100, 0, -100 );
                geometry.vertices.push(p1);
                geometry.vertices.push(p2);
                geometry.colors.push( color1, color2 );

                var line = new THREE.Line( geometry, material, new THREE.LineSegments( geometry, material ) );
                scene.add(line);

        // let painting = false;
        // let lastPoint = { x: undefined, y: undefined };

        // //鼠标按下
        // canvas.onmousedown = function (e) {
        //     console.log("dd")
        //     painting = true;
        //     let x = e.clientX;
        //     let y = e.clientY;
        //     lastPoint = { "x": x, "y": y };
        //    // drawCircle(x, y, 5);
        // };

        // //鼠标移动
        // canvas.onmousemove = function (e) {
        //     let x = e.clientX;
        //     let y = e.clientY;
        //     let newPoint = { "x": x, "y": y };
        //     drawline(lastPoint.x, lastPoint.y, newPoint.x, newPoint, y);
        //     lastPoint = newPoint;
        // };

        // //鼠标松开
        // canvas.onmouseup = function (e) {
        //     painting = false;
        // };

        // //画线函数
        // function drawline(x1, y1, x2, y2) {
        //     if (painting) {
        //         ctx.lineWidth = 3;
        //         ctx.lineCap = "round";
        //         ctx.lineJoin = "round";
        //         ctx.moveTo(x1, y1);
        //         ctx.lineTo(x2, y2);
        //         ctx.stroke(); //绘制图案
        //         ctx.closePath();
        //     }

        // }

    </script>
</body>

</html>